---
- name: Setup ethernet
  template:
    src: ethernet.j2
    dest: /etc/network/interfaces.d/ethernet
  become: true
  notify: retart network

- name: Enable and start portforwarding for ipv4
  sysctl:
    name: net.ipv4.ip_forward
    value: 1
    sysctl_set: yes
    reload: yes

- name: Enable ipv4 nat
  template:
    src: iptables.ipv4.nat.j2
    dest: /etc/iptables.ipv4.nat
  become: true
  notify: reload iptables
  

- name: Restore iptables on reboot
  lineinfile:
    path: /etc/rc.local
    regexp: "^iptables-restore < /etc/iptables.ipv4.nat"
    state: present
    line: "iptables-restore < /etc/iptables.ipv4.nat"
    insertbefore: "exit 0"
